# Resolve Pod Deployment Issue

A junior DevOps team member encountered difficulties deploying a stack on the Kubernetes cluster. The pod fails to start, presenting errors. Let's troubleshoot and rectify the issue promptly.

- There is a pod named `webserver`, and the container within it is named `nginx-container`, its utilizing the `nginx:latest` image.
- Additionally, there's a sidecar container named `sidecar-container` using the ubuntu:latest image.
- Identify and address the issue to ensure the pod is in the `running` state and the application is accessible.

> Note: The kubectl utility on jump_host is configured to interact with the Kubernetes cluster.

## Steps

1. Let's get the status of pods

    ```sh
    kubectl get pod webserver
    ```

    ```shell
     kubectl get pod webserver
    NAME        READY   STATUS             RESTARTS   AGE
    webserver   1/2     ImagePullBackOff   0          10m
    ```

    > we can see there is a problem with container image pulling

2. Let's see in details

    ```sh
    kubectl describe pod webserver
    ```

    > We can see events details at the end:

    ```shell
    Events:
    Type     Reason     Age                   From               Message
    ----     ------     ----                  ----               -------
    Normal   Scheduled  13m                   default-scheduler  Successfully assigned default/webserver to kodekloud-control-plane
    Normal   Pulling    13m                   kubelet            Pulling image "ubuntu:latest"
    Normal   Pulled     13m                   kubelet            Successfully pulled image "ubuntu:latest" in 3.148272011s (3.148286457s including waiting)
    Normal   Created    13m                   kubelet            Created container sidecar-container
    Normal   Started    13m                   kubelet            Started container sidecar-container
    Normal   Pulling    12m (x3 over 13m)     kubelet            Pulling image "nginx:latests"
    Warning  Failed     12m (x3 over 13m)     kubelet            Failed to pull image "nginx:latests": rpc error: code = NotFound desc = failed to pull and unpack image "docker.io/library/nginx:latests": failed to resolve reference "docker.io/library/nginx:latests": docker.io/library/nginx:latests: not found
    Warning  Failed     12m (x3 over 13m)     kubelet            Error: ErrImagePull
    Warning  Failed     12m (x6 over 13m)     kubelet            Error: ImagePullBackOff
    Normal   BackOff    3m32s (x43 over 13m)  kubelet            Back-off pulling image "nginx:latests"
    ```

    > We see there are two container where nignx is getting failed to pull. It seems image tag issue.

3. Let's create a `pod.yml` file from the `webserver` pod

    ```sh
    kubectl get pod webserver -o yaml > pod.yml
    ```

4. Update the nginx container image tag

    ```sh
    vi pod.yml
    ```

    > let's change nginx container image: `nginx:latests` to `nginx:latest`

    ```YAML
    apiVersion: v1
    kind: Pod
    metadata:
    annotations:
        kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"v1","kind":"Pod","metadata":{"annotations":{},"labels":{"app":"web-app"},"name":"webserver","namespace":"default"},"spec":{"containers":[{"image":"nginx:latests","name":"nginx-container","volumeMounts":[{"mountPath":"/var/log/nginx","name":"shared-logs"}]},{"command":["sh","-c","while true; do cat /var/log/nginx/access.log /var/log/nginx/error.log; sleep 30; done"],"image":"ubuntu:latest","name":"sidecar-container","volumeMounts":[{"mountPath":"/var/log/nginx","name":"shared-logs"}]}],"volumes":[{"emptyDir":{},"name":"shared-logs"}]}}
    creationTimestamp: "2025-09-16T15:08:31Z"
    labels:
        app: web-app
    name: webserver
    namespace: default
    resourceVersion: "2169"
    uid: a9c988ea-ed2f-4f6d-92eb-ed282f273c6c
    spec:
    containers:
    - image: nginx:latest
        imagePullPolicy: IfNotPresent
        name: nginx-container
        resources: {}
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /var/log/nginx
        name: shared-logs
        - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-cmx2n
        readOnly: true
    - command:
        - sh
        - -c
        - while true; do cat /var/log/nginx/access.log /var/log/nginx/error.log; sleep
        30; done
        image: ubuntu:latest
        imagePullPolicy: Always
        name: sidecar-container
        resources: {}
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /var/log/nginx
        name: shared-logs
        - mountPath: /var/run/secrets/kubernetes.io/serviceaccount
        name: kube-api-access-cmx2n
        readOnly: true
    dnsPolicy: ClusterFirst
    enableServiceLinks: true
    nodeName: kodekloud-control-plane
    preemptionPolicy: PreemptLowerPriority
    priority: 0
    restartPolicy: Always
    schedulerName: default-scheduler
    securityContext: {}
    serviceAccount: default
    serviceAccountName: default
    terminationGracePeriodSeconds: 30
    tolerations:
    - effect: NoExecute
        key: node.kubernetes.io/not-ready
        operator: Exists
        tolerationSeconds: 300
    - effect: NoExecute
        key: node.kubernetes.io/unreachable
        operator: Exists
        tolerationSeconds: 300
    volumes:
    - emptyDir: {}
        name: shared-logs
    - name: kube-api-access-cmx2n
        projected:
        defaultMode: 420
        sources:
        - serviceAccountToken:
            expirationSeconds: 3607
            path: token
        - configMap:
            items:
            - key: ca.crt
                path: ca.crt
            name: kube-root-ca.crt
        - downwardAPI:
            items:
            - fieldRef:
                apiVersion: v1
                fieldPath: metadata.namespace
                path: namespace
    status:
    conditions:
    - lastProbeTime: null
        lastTransitionTime: "2025-09-16T15:08:31Z"
        status: "True"
        type: Initialized
    - lastProbeTime: null
        lastTransitionTime: "2025-09-16T15:08:31Z"
        message: 'containers with unready status: [nginx-container]'
        reason: ContainersNotReady
        status: "False"
        type: Ready
    - lastProbeTime: null
        lastTransitionTime: "2025-09-16T15:08:31Z"
        message: 'containers with unready status: [nginx-container]'
        reason: ContainersNotReady
        status: "False"
        type: ContainersReady
    - lastProbeTime: null
        lastTransitionTime: "2025-09-16T15:08:31Z"
        status: "True"
        type: PodScheduled
    containerStatuses:
    - image: nginx:latests
        imageID: ""
        lastState: {}
        name: nginx-container
        ready: false
        restartCount: 0
        started: false
        state:
        waiting:
            message: Back-off pulling image "nginx:latests"
            reason: ImagePullBackOff
    - containerID: containerd://675404859dcc69803025764a26dafaf3d651c8827af1c6379ad10091f77b048d
        image: docker.io/library/ubuntu:latest
        imageID: docker.io/library/ubuntu@sha256:590e57acc18d58cd25d00254d4ca989bbfcd7d929ca6b521892c9c904c391f50
        lastState: {}
        name: sidecar-container
        ready: true
        restartCount: 0
        started: true
        state:
        running:
            startedAt: "2025-09-16T15:08:35Z"
    hostIP: 172.17.0.2
    phase: Pending
    podIP: 10.244.0.5
    podIPs:
    - ip: 10.244.0.5
    qosClass: BestEffort
    startTime: "2025-09-16T15:08:31Z"
    ```

5. lets re-create the pod

    ```sh
    kubectl delete pod webserver
    kubectl apply -f pod.yml
    ```

6. We can verify:

    ```sh
    kubectl get pod webserver
    ```

    > we can see the pod is running

7. Access webpage

    ```sh
    curl localhost:8080
    ```
